#!/bin/perl
use strict;


my $counter = 0;
my $cbr_rate = 1;
my $total_pkg_size = 0;
my $start_time = 1;
my $end_time = 6;

while ($cbr_rate < 11) {
  $counter = 0;
  while ($counter <= 0) {
    my $total_pkg_size = 0;
    my $result=`ns ./exp1.tcl $cbr_rate Reno`;
    my $filename = "./exp1_Reno_".$cbr_rate.".tr";
    open(my $fh, '<', $filename) or die "error while opening file $filename";

    while (my $row = <$fh>) {
      my @elems = split ' ', $row; 
      my $event = @elems[0];
      my $from = @elems[2];
      my $to = @elems[3];
      my $pkg_size= @elems[5];
      my $fid = @elems[7];
      if($event == "r" && $from  == "2" && $to =="3" && $fid=="1") {
        $total_pkg_size = $total_pkg_size + $pkg_size;
      }

      $end_time = @elems[1];

      }
      close($fh);
    my $throughput = ($total_pkg_size * 8) / (($end_time - $start_time) * 1000000);
    print $result.": ".$throughput."\n";

    $counter = $counter + 1;
  }
  $cbr_rate = $cbr_rate + 0.5 ;

}
